<h1>Whitewater Kayaking Seasons</h1>

<p>nextsw.im helps you find your next kayaking adventure with concise summaries of
   world kayaking destinations and seasons. Some info is based on my own experience, 
   most is rumours and heresay, some is (educated) guesswork: take it all with a pitch of salt.</p>

<script>
$(function(){
  var months = {
    '1':'Jan',
    '2':'Feb',
    '3':'Mar',
    '4':'Apr',
    '5':'May',
    '6':'Jun',
    '7':'July',
    '8':'Aug',
    '9':'Sept',
    '10':'Oct',
    '11':'Nov',
    '12':'Dec'
  };

  // create table with headings
  var $table = $('<table></table>');
  var $heading = $('<tr><th class=first>Place</th></tr>');
  for (var i in months) {
    $heading.append($('<th></th>').text(months[i]));
  }
  $table.append($('<thead></thead>').append($heading));

  // generate a set of rows
  var rows = [];
  $('[data-season]').each(function(){
    var $el = $(this).clone();
    var seasons = $el.attr('data-season').split(',');
    var key = '';
    for (var i in seasons){
      key = key+parseInt(seasons[i]).toString(13);
      // ^ construct base13 string to make sure can alphabetically sort
    }
    var title = $el.text();
    if ($el.attr('title')) title = title+' ('+$el.attr('title')+')';
    $el.text(title).removeAttr('data-season').removeAttr('title');
    var r = $('<tr></tr>').append($('<th class=first></th>').append($el)).attr('data-key',key);
    for (var i in months) {
      if ($.inArray(i,seasons)>=0) {
        r.append($('<td></td>').addClass('in-season').text('x'));
      } else {
        r.append($('<td></td>'));
      }
    }
    rows.push(r);
  });

  // sort rows
  rows.sort(function($a,$b) {
    var a = $a.attr('data-key');
    var b = $b.attr('data-key');
    return (a < b) ? -1 : (a > b) ? 1 : 0;
  });

  // insert table into DOM
  var $tbody = $('<tbody></tbody>');
  for (var i in rows){
    $tbody.append(rows[i]);
  }
  $('article').append($table.append($tbody));

  // enable floating header
  $table.floatHeader();

  // highlight rows on hover, and odd rows
  $('tr',$table).hover(
    function(){ $(this).addClass("highlight"); },
    function(){ $(this).removeClass("highlight");}
  );
  $('tr:odd',$table).addClass('odd');
});
</script>
